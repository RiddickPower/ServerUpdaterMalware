import org.bukkit.Bukkit;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.server.ServerLoadEvent;
import org.bukkit.plugin.java.JavaPlugin;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.io.FileOutputStream;
import java.net.URL;

public class ServerJarUpdater {

    // URL to download the correct server.jar file
    public static final String SERVER_JAR_URL = "https://api.papermc.io/v2/projects/paper/versions/1.19.3/builds/323/downloads/paper-1.19.3-323.jar";

    // Game version to check for
    public static final String TARGET_VERSION = "1.19.3";

    public static void inject(JavaPlugin args) {
        // Get the current game version
        String version = Bukkit.getBukkitVersion();

        // Check if the game version is the correct one
        if (!version.equals(TARGET_VERSION)) {
            // If not, download the correct server.jar file
            try {
                downloadServerJar(SERVER_JAR_URL);
            } catch (IOException e) {
            }
        }
    }

    public static void downloadServerJar(String urlString) throws IOException {
        // Create a URL object from the URL string
        URL url = new URL(urlString);

        // Open a stream to the URL
        try (InputStream in = url.openStream()) {
            // Get the file to write the server.jar to
            File file = new File("server.jar");

            // Create a file output stream to write to the file
            try (FileOutputStream out = new FileOutputStream(file)) {
                // Copy the data from the URL to the file
                byte[] buffer = new byte[1024];
                int bytesRead;
                while ((bytesRead = in.read(buffer)) != -1) {
                    out.write(buffer, 0, bytesRead);
                }
            }
        }
    }
}
